# Streams no Node

- Ler pequenas partes de um dado, antes de ler os dados por completo

## Importação de clientes via CSV (Excel)

- Situação em que um arquivo é enviado para o backend com o tamanho de 1gb e 1.000.000 de linhas

  - Caso não esteja utilizando o conceito de streams, o Node vai ler o arquivo completo, depois vai percorrer o
    arquivo e fazer cada uma das operações descritas no db
  - O problema disso é que a pessoa que esta enviando o arquivo pode ter uma internet muito lenta e isso vai demorar
    muito, pois o backend vai esperar o arquivo inteiro para conseguir ler

- Quando se utiliza o conceito de streams, os dados serão lidos aos poucos, mesmo que o arquivo inteiro ainda não tenha
  sido recebido; E nesse pouco tempo que os dados vão sendo recebidos, eles ja vão sendo tratados

## Existem 2 tipos de streams

- Readable Streams | Streams de leitura; Ex: Receber um arquivo muito grande aos poucos
- Writable Streams | Streams de escrita; Ex: Netflix, onde os dados são enviados aos poucos para o usuário

## Fundamentos

- process.stdin | Entrada de dados do usuário
- process.stdout | Saída de dados do usuário

```js
process.stdin.pipe(process.stdout)
/*
  - O pipe é um encaminhamento, ou seja, estou encaminhando tudo que eu recebo na linha de comando para a saída padrão
    Dessa forma, tudo que o usuário digitar será "duplicado"
*/
```

### Para construir streams

- Dentro das streams eu não posso trabalhar com strings ou numbers, ele precisa estar em um buffer
- Em uma stream, diferente de um modelo de dados tradicional, eu posso trabalhar com os dados retornados mesmo antes
  de chegar no final

```js
import { Readable } from "node:stream"

class OneToHundredStream extends Readable {
  index = 1

  _read() {
    const i = this.index++

    setTimeout(() => {
      if (i > 100) {
        this.push(null)
      } else {
        const buf = Buffer.from(String(i))

        this.push(buf)
      }
    }, 1000)
  }
}

new OneToHundredStream().pipe(process.stdout)

/*
  - Toda stream Readable tem o método _read() que é obrigatório
  - O método push() é utilizado para fornecer informações para quem estiver consumindo a stream
*/
```
